---
  name: Continuous Integration

  on:
    push:
      branches:
        - main
    pull_request:
      branches:
        - main

  jobs:
    build:
      runs-on: ubuntu-latest
      env:
        CONFIGURATION: Release
      permissions:
        packages: write
        contents: read

      steps:
        - uses: actions/checkout@v4
        - name: Setup .NET
          uses: actions/setup-dotnet@v3
          with:
            dotnet-version: 7.0.x
        - name: Restore dependencies
          run: dotnet restore
        - name: Build
          run: dotnet build --no-restore --configuration ${{ env.CONFIGURATION }}
        - name: Test
          run: dotnet test --no-build --configuration ${{ env.CONFIGURATION }} --verbosity normal
        - name: Push package to GitHub packages
          if: github.ref == 'refs/heads/main'
          run: dotnet nuget push ./**/*.nupkg --source "https://nuget.pkg.github.com/$GITHUB_REPOSITORY_OWNER/index.json" --api-key ${{ secrets.GITHUB_TOKEN }} --skip-duplicate
